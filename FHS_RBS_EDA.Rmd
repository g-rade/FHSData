---
title: "FHS_RBC_EDA"
author: "Grace Rade"
date: "2022-10-13"
output: html_document
---
```{r}
library(survival)
library(tidyverse)
library(rio)
library(survminer)
library(haven)
library(survRM2)


## load the datasets
all_data <- read_csv('rmst_methods_paper7.csv')
rbc_data <- read_dta("datasets_copy/dr281_l_rbcfa_2008_m_0420s_v1.dta")
last_contact <- read_sas("datasets_copy/dr281_vr_survdth_2019_a_1337s.sas7bdat")
cvd_data <- read_dta("FHS 2154 - datasets/dr281_vr_survcvd_2014_a_1023s.dta") %>% 
  select(IDTYPE, ranid, cvd, chd, chf)
event_data <- read_sas("datasets_copy/dr281_vr_soe_2020_a_1340s.sas7bdat") %>%
  select(idtype, ranid, DATE, EVENT) %>% 
  rename(IDTYPE = idtype) %>% 
  filter(EVENT %in% c(20, 21, 22, 23, 24, 25, 26, 27, 28, 29))

all_data2 <- all_data %>% 
  left_join(rbc_data, by = "ranid")  


```

```{r}
## getting some percentiles for arachidonic acid and egfr ratio
quantile(rbc_data$RBC_C20_4n6, probs = c(0.1, 0.45, 0.55, 0.9))
quantile(all_data2$ratio2, probs = c(0.1, 0.45, 0.55, 0.9), na.rm = TRUE)
```

```{r}
all_data2 %>% 
  group_by(H010) %>% 
  summarise(mean_egfr = mean(ratio2, na.rm = TRUE), median_egfr = median(ratio2, na.rm = TRUE), iqr_egfr = IQR(ratio2, na.rm = TRUE), mean_days = mean(days, na.rm = TRUE), median_days = median(days, na.rm = TRUE), iqr_days = IQR(days, na.rm = TRUE))
```

```{r}
export(all_data2, "rbc_data.csv")
```

