---
title: "FHS_Validation.Rmd"
author: "Grace Rade"
date: '2022-08-31'
output: html_document
---
```{r}
## load packages and read in datasets (tidyverse, haven, and rio were the only packages that I actually needed for this)
library(survival)
library(tidyverse)
library(rio)
library(survminer)
library(haven)
library(survRM2)
library(readxl)

## reading in the data and renaming variables, not much wrangling required for this data
validation_data <- read_excel('Master Database.Revised FinalCohort.10Oct21.xlsx') %>% 
  rename(dead_days = POD...104, event_free = POD...106, last_con = POD...101, Event = 'Death/LVAD/Tx', TBX_group = 'TXB2-M Group') 

## adding the EGFR grouping variable, 0 = low, 1 = high (same with TXB group)
validation_data <- validation_data %>% 
  mutate(EGFR_group = if_else(`TXB2-M/eGFR` > 17.8, 1, 0)) %>% 
  mutate(dead_years = last_con/365.25) %>% 
  mutate(event_free_years = event_free/365.25)


## censoring the years so > 5 <- 5
validation_data$dead_years[validation_data$dead_years > 5] <- 5
validation_data$event_free_years[validation_data$event_free_years > 5] <- 5

## export data
export(validation_data, "validation6.csv")
  
#finding the mean age and making a labeled histogram of age
validation_data_mean <- validation_data %>% 
    summarise(age_mean = mean(Age, 0,na.rm = TRUE))

validation_data %>% 
  ggplot(aes(x = Age)) + 
  geom_histogram(binwidth = 10, color = "coral2") +
  labs(x = "Age", title = "Distribution of Participant Age, 10-year groups") +
  geom_vline(xintercept = 61.58095, color = "cyan3") +
  geom_text(x = 80, y = 30, label = "Mean = 61.58095")
```

